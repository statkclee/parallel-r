<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: R 병렬 프로그래밍</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-19', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">R 병렬 프로그래밍</h1></a>
          <h2 class="subtitle">R 양산환경(<code>plumber</code>) - 타이타닉</h2>
          <h2 id="r-in-production">1. 양산환경 R <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></h2>
<p>웹에서 R을 돌리는 방법은 오래전부터 많이 시도되어 왔고, 이제는 안정화되었다고 봐도 될듯 싶다. 한동안 <code>opencup</code>가 많이 사용되어 왔으나 팩키지를 만들어야 기본적으로 R을 양산환경에 돌릴 수 있다는 부담감(?)으로 작용하는 것도 사실이다. 최근에는 <code>plumber</code></p>
<ul>
<li><code>plumber</code>: <a href="https://github.com/trestletech/plumber">Turn your R code into a web API</a></li>
<li><code>opencpu</code>: <a href="https://www.opencpu.org/">OpenCPU system for embedded scientific computation and reproducible research</a>
<ul>
<li>팩키지를 개발하고 이를 RESTful API 서비스로 제공.</li>
</ul></li>
<li><code>deployR</code>: <a href="http://blog.revolutionanalytics.com/2016/09/the-elements-of-scaling-r-based-applications-with-deployr.html">The elements of scaling R-based applications with DeployR</a>
<ul>
<li>마이크로소프트에서 개발하여 제공.</li>
</ul></li>
<li><code>rapache</code>: <a href="http://rapache.net/">Web Application Development with R and Apache</a>
<ul>
<li>오래전에 개발된 후에 더이상 활발히 개발이 진행되고 있지 않는 것으로 파악됨.</li>
</ul></li>
</ul>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h3 id="opencpu-와-다른-웹도구와-차별점-so-opencpu"><span class="glyphicon glyphicon-pushpin"></span>OpenCPU 와 다른 웹도구와 차별점 <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></h3>
</div>
<div class="panel-body">
<p>OpenCPU is a layer on top of the regular tools (e.g. RApache, rpy2) that defines a framework and protocol for interacting with R. It handles stuff like object serialization, security, resource control, reproducibility etc, while abstracting away technicalities.</p>
</div>
</aside>
<h2 id="intro-to-plumber">2. <code>plumber</code> 팩키지 맛보기</h2>
<p><code>plumber</code> 팩키지를 사용하게 되면 로컬컴퓨터에 웹서버를 띄워 간단하게 웹상에서 R을 사용한다는 의미를 체험하는데 최적이다. 이것이 마음에 들면 확장하여 실운영환경으로 적용해서 최근 활발히 사용하고 있다.</p>
<h3 id="config-webserver-plumber">2.1. 환경설치 및 R 웹서버 띄우기</h3>
<p><code>devtools::install_github(&quot;trestletech/plumber&quot;)</code> 명령어로 R 웹서버를 띄우고 나서, <code>myfile.R</code>에 웹서버를 통해 노출할 함수를 지정하면 된다. 그리고 나서 <code>r$run(port=8000)</code> 명령어를 실행하면 실제로 웹서버에 노출한 함수를 곧바로 활용할 수 있다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">&quot;trestletech/plumber&quot;</span>)

<span class="kw">library</span>(plumber)

r &lt;-<span class="st"> </span><span class="kw">plumb</span>(<span class="st">&quot;code/myfile.R&quot;</span>) 
r$<span class="kw">run</span>(<span class="dt">port=</span><span class="dv">8000</span>)
Starting server to listen on port <span class="dv">8000</span>
Running the swagger UI at http:<span class="er">//</span><span class="fl">127.0.0.1</span>:<span class="dv">8000</span>/__swagger__/</code></pre></div>
<h3 id="plumber-services">2.2. R 웹서버에서 제공하는 서비스</h3>
<p><code>@get</code>, <code>@post</code> 두가지 사례를 <code>normalMean</code>, <code>addTwo</code> 함수를 <code>mean</code>, <code>sum</code>을 통해 서비스로 제공하고 있다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#* @get /mean</span>
normalMean &lt;-<span class="st"> </span>function(<span class="dt">samples=</span><span class="dv">10</span>){
    data &lt;-<span class="st"> </span><span class="kw">rnorm</span>(samples)
    <span class="kw">mean</span>(data)
}

<span class="co">#* @post /sum</span>
addTwo &lt;-<span class="st"> </span>function(a, b){
    <span class="kw">as.numeric</span>(a) +<span class="st"> </span><span class="kw">as.numeric</span>(b)
}</code></pre></div>
<h3 id="plumber-in-service">2.3. 실행 사례</h3>
<p><code>curl &quot;http://localhost:8000/mean&quot;</code> 명령어를 실행시키면 <code>localhost</code>, 8000포트를 통해 <code>mean</code> 서비스가 요청되고, 기본설정된 매개변수 <code>sample=10</code>이 전달되어 표준정규분포에서 표본을 10개 뽑아 평균을 계산하고 출력결과를 반환시킨다.</p>
<p><code>curl --data '{&quot;a&quot;:4, &quot;b&quot;:5}' http://localhost:8000/sum</code> 명령어를 실행시키면 <code>localhost</code>, 8000포트를 통해 <code>sum</code> 서비스를 json 형식 데이터를 전달하여, 두값을 더한 후 결과값을 반환시킨다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">$<span class="st"> </span>curl <span class="st">&quot;http://localhost:8000/mean&quot;</span>
[-<span class="fl">0.6062</span>]
$<span class="st"> </span>curl <span class="st">&quot;http://localhost:8000/mean?samples=1000&quot;</span>
[-<span class="fl">0.0021</span>]
$<span class="st">  </span>curl --data <span class="st">&quot;a=4&amp;b=3&quot;</span> <span class="st">&quot;http://localhost:8000/sum&quot;</span>
[<span class="dv">7</span>]
$<span class="st"> </span>curl --data <span class="st">&#39;{&quot;a&quot;:4, &quot;b&quot;:5}&#39;</span> http:<span class="er">//</span>localhost:<span class="dv">8000</span>/sum
[<span class="dv">9</span>]</code></pre></div>
<h2 id="타이타닉-생존-확률-예측-서비스-titanic-plumber-api">3. 타이타닉 생존 확률 예측 서비스 <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></h2>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://www.quora.com/How-do-I-expose-R-code-as-a-web-service">How do I expose R code as a web service?</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="https://stackoverflow.com/questions/8858429/whats-the-intention-of-opencpu-org-compared-to-other-approaches/8916615#8916615">What is the intention of opencpu.org compared to other approaches?</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="https://raybuhr.github.io/2017/10/making-predictions-over-http/">raybuhr blog, Making Predictions over HTTP with R October 17, 2017</a><a href="#fnref3">↩</a></p></li>
</ol>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-37305346-2', 'auto');
      ga('send', 'pageview');
    
    </script>
  </body>
</html>
